"use strict";(self.webpackChunkpepegov_chat_client_web_minimal=self.webpackChunkpepegov_chat_client_web_minimal||[]).push([[961],{873:(e,t,o)=>{function n(e){return function(t){t.prototype.selector=e.selector,t.prototype.templateUrl=e.templateUrl}}o.d(t,{u:()=>n})},963:(e,t,o)=>{o.d(t,{A:()=>r});var n=o(467);class r{constructor(e){this.accessTokenFactory=void 0,this.accessTokenFactory=e}GetAsync(e){var t=this;return(0,n.A)((function*(){var o={};t.accessTokenFactory&&(o={Authorization:"Bearer ".concat(t.accessTokenFactory())});var n=yield fetch(e,{method:"GET",headers:o});return yield n.json()}))()}}},954:(e,t,o)=>{var n=o(873),r=o(467),s=o(711),c=o(963);class a{constructor(){this.openIdService=void 0,this.httpClient=void 0,this.baseUrl="https://api.chat.pepegov.ru/api/",this.openIdService=new s.d,this.httpClient=new c.A((()=>this.openIdService.GetAccessTokenOnStorage()))}GetRooms(e,t){var o=this;return(0,r.A)((function*(){var n=o.baseUrl+"room/get-paged?pageIndex="+e+"&pageSize="+t;return o.openIdService.GetAccessTokenOnStorage(),yield o.httpClient.GetAsync(n)}))()}}(0,n.u)({selector:"app",templateUrl:"./lobby.component.html"})(class{constructor(){this.chatHubService=void 0,this.chatHubService=new a}OnLoad(){this.chatHubService.GetRooms(0,20).then((e=>{var t,o;if(!e.isSuccessful){var n,r=null===(n=e.exceptions)||void 0===n?void 0:n.map(((e,t)=>"ERROR"+t+": source "+e.source+" message "+e.message));console.log(null==r?void 0:r.join("\n"))}null!==(t=e.message)&&void 0!==t&&t.items&&this.addToTable(null===(o=e.message)||void 0===o?void 0:o.items)}))}addToTable(e){var t=document.querySelector("#lobby-table-body");e.forEach((e=>{var o=this.createTableRow(e);null==t||t.appendChild(o)}))}createTableRow(e){var t=document.createElement("tr");return t.innerHTML="\n                <td>".concat(e.id,"</td>\n                <td>").concat(e.memberCount,"</td>\n                <td>").concat(e.name,"</td>\n                <td>").concat(e.owner,'</td>\n                <td><a href="/room?id=').concat(e.id,'" class="join">Login</a></td>\n            '),t}})},711:(e,t,o)=>{o.d(t,{d:()=>a});var n=o(467),r=o(963),s={client:{id:"MicroservicePassword-ID",secret:"MicroservicePassword-SECRET"},auth:{tokenHost:"https://identity.pepegov.ru"}},c=function(e){return e.ClientCredentials="ClientCredentials",e.ResourceOwnerPassword="ResourceOwnerPassword",e.AuthorizationCode="AuthorizationCode",e}(c||{});class a{constructor(){this.httpClient=void 0,this.httpClient=new r.A((()=>this.GetAccessTokenOnStorage()))}ResourceOwnerPasswordAuth(e,t,o){return(0,n.A)((function*(){var n=new i(s),r=yield n.ResourceOwnerPasswordAuth(e,t,o);r&&(console.log("Access Token:",r.access_token),console.log("ID Token:",r.id_token),console.log("Refresh Token:",r.refresh_token),localStorage.setItem("access_token",r.access_token),localStorage.setItem("token_type",c.ResourceOwnerPassword))}))()}parseJwt(e){var t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT token");var o=t[1],n=this.decodeBase64Url(o);return JSON.parse(n)}decodeBase64Url(e){var t=e.replace(/-/g,"+").replace(/_/g,"/"),o=t.padEnd(t.length+(4-t.length%4)%4,"=");return atob(o)}isTokenAlive(e){try{var t=this.parseJwt(e);if(!t.exp)throw new Error("Token does not contain an exp claim");return Math.floor(Date.now()/1e3)<t.exp}catch(e){return console.error("Failed to parse token or token is invalid",e),!1}}GetAccessTokenOnStorage(){var e=localStorage.getItem("access_token");return e&&this.isTokenAlive(e)?e:(window.location.href="/login",null)}GetUserInfoAsync(){var e=this;return(0,n.A)((function*(){return e.httpClient.GetAsync(s.auth.tokenHost+"/connect/userinfo")}))()}}class i{constructor(e){this.config=void 0,this.config=e}ResourceOwnerPasswordAuth(e,t,o){var r=this;return(0,n.A)((function*(){var n=new URLSearchParams({username:e,password:t,grant_type:"password",scope:o.join(" "),client_secret:r.config.client.secret,client_id:r.config.client.id});try{var c=yield fetch(s.auth.tokenHost+"/connect/token",{body:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"post"}),a=yield c.json();if(a.hasOwnProperty("access_token"))return yield a;var i=a;console.log(i)}catch(i){console.log("Access Token Error",i)}}))()}}},467:(e,t,o)=>{function n(e,t,o,n,r,s,c){try{var a=e[s](c),i=a.value}catch(e){return void o(e)}a.done?t(i):Promise.resolve(i).then(n,r)}function r(e){return function(){var t=this,o=arguments;return new Promise((function(r,s){var c=e.apply(t,o);function a(e){n(c,r,s,a,i,"next",e)}function i(e){n(c,r,s,a,i,"throw",e)}a(void 0)}))}}o.d(t,{A:()=>r})}},e=>{e(e.s=954)}]);