"use strict";(self.webpackChunkpepegov_chat_client_web_minimal=self.webpackChunkpepegov_chat_client_web_minimal||[]).push([[961],{3056:(e,t,n)=>{n.r(t)},6371:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=function(e){return function(t){t.prototype.selector=e.selector,t.prototype.templateUrl=e.templateUrl}}},3761:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.accessTokenFactory=e}GetAsync(e){return n(this,void 0,void 0,(function*(){let t={};this.accessTokenFactory&&(t={Authorization:`Bearer ${this.accessTokenFactory()}`});const n=yield fetch(e,{method:"GET",headers:t});return yield n.json()}))}}},8377:function(e,t,n){var o=this&&this.__esDecorate||function(e,t,n,o,r,i){function c(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,a=o.kind,l="getter"===a?"get":"setter"===a?"set":"value",u=!t&&e?o.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,o.name):{}),h=!1,p=n.length-1;p>=0;p--){var f={};for(var v in o)f[v]="access"===v?{}:o[v];for(var v in o.access)f.access[v]=o.access[v];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(c(e||null))};var m=(0,n[p])("accessor"===a?{get:d.get,set:d.set}:d[l],f);if("accessor"===a){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(s=c(m.get))&&(d.get=s),(s=c(m.set))&&(d.set=s),(s=c(m.init))&&r.unshift(s)}else(s=c(m))&&("field"===a?r.unshift(s):d[l]=s)}u&&Object.defineProperty(u,o.name,d),h=!0},r=this&&this.__runInitializers||function(e,t,n){for(var o=arguments.length>2,r=0;r<t.length;r++)n=o?t[r].call(e,n):t[r].call(e);return o?n:void 0},i=this&&this.__setFunctionName||function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};Object.defineProperty(t,"__esModule",{value:!0}),t.LobbyPageComponent=void 0,n(3056);const c=n(6371),s=n(6028);let a=(()=>{let e,t,n=[(0,c.Component)({selector:"app",templateUrl:"./lobby.component.html"})],a=[];return t=class{constructor(){this.chatHubService=new s.ChatHubService}OnLoad(){this.chatHubService.GetRooms(0,20).then((e=>{var t,n,o;if(!e.isSuccessful){const n=null===(t=e.exceptions)||void 0===t?void 0:t.map(((e,t)=>"ERROR"+t+": source "+e.source+" message "+e.message));console.log(null==n?void 0:n.join("\n"))}(null===(n=e.message)||void 0===n?void 0:n.items)&&this.addToTable(null===(o=e.message)||void 0===o?void 0:o.items)}))}addToTable(e){const t=document.querySelector("#lobby-table-body");e.forEach((e=>{const n=this.createTableRow(e);null==t||t.appendChild(n)}))}createTableRow(e){const t=document.createElement("tr");return t.innerHTML=`\n                <td>${e.id}</td>\n                <td>${e.memberCount}</td>\n                <td>${e.name}</td>\n                <td>${e.owner}</td>\n                <td><a href="/room?id=${e.id}" class="join">Login</a></td>\n            `,t}},i(t,"LobbyPageComponent"),(()=>{const i="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;o(null,e={value:t},n,{kind:"class",name:t.name,metadata:i},null,a),t=e.value,i&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i}),r(t,a)})(),t})();t.LobbyPageComponent=a},6028:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatHubService=void 0;const i=n(3653),c=r(n(3761));t.ChatHubService=class{constructor(){this.baseUrl="https://api.chat.pepegov.ru/api/",this.openIdService=new i.SimpleOpenIdService,this.httpClient=new c.default((()=>this.openIdService.GetAccessTokenOnStorage()))}GetRooms(e,t){return o(this,void 0,void 0,(function*(){const n=this.baseUrl+"room/get-paged?pageIndex="+e+"&pageSize="+t;return this.openIdService.GetAccessTokenOnStorage(),yield this.httpClient.GetAsync(n)}))}}},3653:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenIdClient=t.SimpleOpenIdService=void 0;const i=r(n(3761)),c={client:{id:"MicroservicePassword-ID",secret:"MicroservicePassword-SECRET"},auth:{tokenHost:"https://identity.pepegov.ru"}};var s;!function(e){e.ClientCredentials="ClientCredentials",e.ResourceOwnerPassword="ResourceOwnerPassword",e.AuthorizationCode="AuthorizationCode"}(s||(s={})),t.SimpleOpenIdService=class{constructor(){this.httpClient=new i.default((()=>this.GetAccessTokenOnStorage()))}ResourceOwnerPasswordAuth(e,t,n){return o(this,void 0,void 0,(function*(){var o=new a(c);const r=yield o.ResourceOwnerPasswordAuth(e,t,n);r&&(console.log("Access Token:",r.access_token),console.log("ID Token:",r.id_token),console.log("Refresh Token:",r.refresh_token),localStorage.setItem("access_token",r.access_token),localStorage.setItem("token_type",s.ResourceOwnerPassword))}))}parseJwt(e){const t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT token");const n=t[1],o=this.decodeBase64Url(n);return JSON.parse(o)}decodeBase64Url(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=t.padEnd(t.length+(4-t.length%4)%4,"=");return atob(n)}isTokenAlive(e){try{const t=this.parseJwt(e);if(!t.exp)throw new Error("Token does not contain an exp claim");return Math.floor(Date.now()/1e3)<t.exp}catch(e){return console.error("Failed to parse token or token is invalid",e),!1}}GetAccessTokenOnStorage(){let e=localStorage.getItem("access_token");return e&&this.isTokenAlive(e)?e:(window.location.href="/login",null)}GetUserInfoAsync(){return o(this,void 0,void 0,(function*(){return this.httpClient.GetAsync(c.auth.tokenHost+"/connect/userinfo")}))}};class a{constructor(e){this.config=e}ResourceOwnerPasswordAuth(e,t,n){return o(this,void 0,void 0,(function*(){let o=new URLSearchParams({username:e,password:t,grant_type:"password",scope:n.join(" "),client_secret:this.config.client.secret,client_id:this.config.client.id});try{const e=yield fetch(c.auth.tokenHost+"/connect/token",{body:o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"post"});let t=yield e.json();if(t.hasOwnProperty("access_token"))return yield t;const n=t;console.log(n)}catch(e){console.log("Access Token Error",e)}}))}}t.OpenIdClient=a}},e=>{e(e.s=8377)}]);