"use strict";(self.webpackChunkpepegov_chat_client_web_minimal=self.webpackChunkpepegov_chat_client_web_minimal||[]).push([[961],{56:(e,t,n)=>{n.r(t)},371:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=function(e){return function(t){t.prototype.selector=e.selector,t.prototype.templateUrl=e.templateUrl}}},761:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.accessTokenFactory=e}return e.prototype.GetAsync=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t={},this.accessTokenFactory&&(t={Authorization:"Bearer ".concat(this.accessTokenFactory())}),[4,fetch(e,{method:"GET",headers:t})];case 1:return[4,n.sent().json()];case 2:return[2,n.sent()]}}))}))},e}();t.default=r},377:function(e,t,n){var o=this&&this.__esDecorate||function(e,t,n,o,r,i){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var c,s=o.kind,u="getter"===s?"get":"setter"===s?"set":"value",l=!t&&e?o.static?e:e.prototype:null,f=t||(l?Object.getOwnPropertyDescriptor(l,o.name):{}),p=!1,h=n.length-1;h>=0;h--){var d={};for(var v in o)d[v]="access"===v?{}:o[v];for(var v in o.access)d.access[v]=o.access[v];d.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(e||null))};var y=(0,n[h])("accessor"===s?{get:f.get,set:f.set}:f[u],d);if("accessor"===s){if(void 0===y)continue;if(null===y||"object"!=typeof y)throw new TypeError("Object expected");(c=a(y.get))&&(f.get=c),(c=a(y.set))&&(f.set=c),(c=a(y.init))&&r.unshift(c)}else(c=a(y))&&("field"===s?r.unshift(c):f[u]=c)}l&&Object.defineProperty(l,o.name,f),p=!0},r=this&&this.__runInitializers||function(e,t,n){for(var o=arguments.length>2,r=0;r<t.length;r++)n=o?t[r].call(e,n):t[r].call(e);return o?n:void 0},i=this&&this.__setFunctionName||function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};Object.defineProperty(t,"__esModule",{value:!0}),t.LobbyPageComponent=void 0,n(56);var a,c,s,u,l,f=n(371),p=n(28),h=(u=[(0,f.Component)({selector:"app",templateUrl:"./lobby.component.html"})],l=[],c=function(){function e(){this.chatHubService=new p.ChatHubService}return e.prototype.OnLoad=function(){var e=this;this.chatHubService.GetRooms(0,20).then((function(t){var n,o,r;if(!t.isSuccessful){var i=null===(n=t.exceptions)||void 0===n?void 0:n.map((function(e,t){return"ERROR"+t+": source "+e.source+" message "+e.message}));console.log(null==i?void 0:i.join("\n"))}(null===(o=t.message)||void 0===o?void 0:o.items)&&e.addToTable(null===(r=t.message)||void 0===r?void 0:r.items)}))},e.prototype.addToTable=function(e){var t=this,n=document.querySelector("#lobby-table-body");e.forEach((function(e){var o=t.createTableRow(e);null==n||n.appendChild(o)}))},e.prototype.createTableRow=function(e){var t=document.createElement("tr");return t.innerHTML="\n                <td>".concat(e.id,"</td>\n                <td>").concat(e.memberCount,"</td>\n                <td>").concat(e.name,"</td>\n                <td>").concat(e.owner,'</td>\n                <td><a href="/room?id=').concat(e.id,'" class="join">Login</a></td>\n            '),t},e}(),i(c,"LobbyPageComponent"),s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0,o(null,a={value:c},u,{kind:"class",name:c.name,metadata:s},null,l),c=a.value,s&&Object.defineProperty(c,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(c,l),c);t.LobbyPageComponent=h},28:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatHubService=void 0;var a=n(653),c=i(n(761)),s=function(){function e(){var e=this;this.baseUrl="https://api.chat.pepegov.ru/api/",this.openIdService=new a.SimpleOpenIdService,this.httpClient=new c.default((function(){return e.openIdService.GetAccessTokenOnStorage()}))}return e.prototype.GetRooms=function(e,t){return o(this,void 0,void 0,(function(){var n;return r(this,(function(o){switch(o.label){case 0:return n=this.baseUrl+"room/get-paged?pageIndex="+e+"&pageSize="+t,this.openIdService.GetAccessTokenOnStorage(),[4,this.httpClient.GetAsync(n)];case 1:return[2,o.sent()]}}))}))},e}();t.ChatHubService=s},653:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenIdClient=t.SimpleOpenIdService=void 0;var a,c=i(n(761)),s={client:{id:"MicroservicePassword-ID",secret:"MicroservicePassword-SECRET"},auth:{tokenHost:"https://identity.pepegov.ru"}};!function(e){e.ClientCredentials="ClientCredentials",e.ResourceOwnerPassword="ResourceOwnerPassword",e.AuthorizationCode="AuthorizationCode"}(a||(a={}));var u=function(){function e(){var e=this;this.httpClient=new c.default((function(){return e.GetAccessTokenOnStorage()}))}return e.prototype.ResourceOwnerPasswordAuth=function(e,t,n){return o(this,void 0,void 0,(function(){var o;return r(this,(function(r){switch(r.label){case 0:return[4,new l(s).ResourceOwnerPasswordAuth(e,t,n)];case 1:return(o=r.sent())&&(console.log("Access Token:",o.access_token),console.log("ID Token:",o.id_token),console.log("Refresh Token:",o.refresh_token),localStorage.setItem("access_token",o.access_token),localStorage.setItem("token_type",a.ResourceOwnerPassword)),[2]}}))}))},e.prototype.parseJwt=function(e){var t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT token");var n=t[1],o=this.decodeBase64Url(n);return JSON.parse(o)},e.prototype.decodeBase64Url=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=t.padEnd(t.length+(4-t.length%4)%4,"=");return atob(n)},e.prototype.isTokenAlive=function(e){try{var t=this.parseJwt(e);if(!t.exp)throw new Error("Token does not contain an exp claim");return Math.floor(Date.now()/1e3)<t.exp}catch(e){return console.error("Failed to parse token or token is invalid",e),!1}},e.prototype.GetAccessTokenOnStorage=function(){var e=localStorage.getItem("access_token");return e&&this.isTokenAlive(e)?e:(window.location.href="/login",null)},e.prototype.GetUserInfoAsync=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.httpClient.GetAsync(s.auth.tokenHost+"/connect/userinfo")]}))}))},e}();t.SimpleOpenIdService=u;var l=function(){function e(e){this.config=e}return e.prototype.ResourceOwnerPasswordAuth=function(e,t,n){return o(this,void 0,void 0,(function(){var o,i,a,c;return r(this,(function(r){switch(r.label){case 0:o=new URLSearchParams({username:e,password:t,grant_type:"password",scope:n.join(" "),client_secret:this.config.client.secret,client_id:this.config.client.id}),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,fetch(s.auth.tokenHost+"/connect/token",{body:o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"post"})];case 2:return[4,r.sent().json()];case 3:return(i=r.sent()).hasOwnProperty("access_token")?[4,i]:[3,5];case 4:return[2,r.sent()];case 5:return a=i,console.log(a),[3,7];case 6:return c=r.sent(),console.log("Access Token Error",c),[3,7];case 7:return[2]}}))}))},e}();t.OpenIdClient=l}},e=>{e(e.s=377)}]);